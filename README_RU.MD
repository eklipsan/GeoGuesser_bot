# Телеграм-бот Gucotomap

Простая игра по угадыванию мест на карте с помощью телеграм-бота
Gucotomomap - это по сути аббревиатура от "Guess the country by the town on the map"

Вы можете поиграть в нее прямо сейчас, перейдя по следующей ссылке https://t.me/gucotomap_bot

![](readme_files/gameplay2.4.gif)



# Технологии

- Python 3.10
    - aiogram - библиотека для разработки ботов Telegram
    - pymongo - библиотека для хранения пользовательских данных в MongoDB


# Общая информация
Этот проект представляет собой telegram-бота, который предлагает сыграть в игру, где нужно угадать, к какой стране относится город, изображенный на карте. Для создания карт используется Static API map от Яндекса. Прилагаю ссылку на документацию к ней [ссылка](https://yandex.ru/dev/staticapi/doc/en/quickstart). Используя библиотеку aiogram, мы разрабатываем нашего telegram-бота. Вот ссылка [ссылка](https://aiogram.dev) на нее. Также я использую облачную MongoDB для хранения пользовательских данных [ссылка](https://cloud.mongodb.com).


## API Reference

### Пример API-запроса
```
https://static-maps.yandex.ru/v1?ll=37.620070,55.753630&size=450,450&z=13&pt=37.620070,55.753630,pmwtm1~37.64,55.76363,pmwtm99&apikey=YOUR_API_KEY
```
Образец результата API-запроса
![](readme_files/map_photos//Delhi.png "India, Delhi")
![](readme_files/map_photos/Guangzhou.png "China, Guangzhou")
![](readme_files/map_photos/Jakarta.png "Indonesia, Jakarta")
## Логика работы бота

- bot.py - связывает все компоненты и запускает бота
- workers
    - map_worker.py - работает с api-map, и представляет собой главное в этой игре - создание изображения карты и предоставление вариантов ответа.
    - menu.py - устанавливает опции меню (/start, /help и т.д.)
    - database.py - упрощает работу с пользовательскими данными из облачной MongoDB
    - logset.py - производит логирование работы бота. Логирование можно настроить через .env файл
- map_data - хранит файл формата json, в котором город представлен как словарь. Например:
```json
"Tokyo": {
        "широта": 35.6897,
        "longtitude": 139.6922,
        "страна": "Япония",
        "столица": "Токио",
        "население": 37732000.0
    }
```
- keyboards
    - menu_keyboards.py - хранит кнопки типа InlineKeyboard, ReplyKeyboard, которые используются, когда наш пользователь находится в главном меню.
    - user_keyboards.py - хранит то же самое, но они используются, когда пользователь находится в игровом процессе.
    - parameters_keyboards.py - хранит кнопки, которые используются для установки параметров игры.
- handlers
    - admin_handlers.py - обработчики аиограмм, которые доступны пользователям-администраторам (они находятся в .env)
    - command_handlers.py - обработчки команд, которые начинаются с '/'
    - menu_handlers.py - основные обработчики, которые используются для навигации по меню
    - user_handlers.py - обработчики, которые используются, когда пользователь находится в игре.
    - pass_handlers.py - заглушка, отвечающая объяснением отсутствия такой команды.
- config_data
  - config.py - хранит класс Config, в котором хранятся все полученные данные из файла .env.
- фильтры доступа
  - tg_filter.py - хранит фильтры для обработчиков.

## Инструкция по развертыванию

Чтобы развернуть Gucotomap Telegram Bot, выполните следующие шаги:

### 1. Склонируйте репозиторий

Сначала склонируйте репозиторий на локальную машину или сервер, на котором вы собираетесь запустить бота.

```bash
git clone https://github.com/eklipsan/Gucotomap_bot
cd Gucotomap_bot
```
### 2. Настройка виртуального окружения

Для Python-проектов рекомендуется использовать виртуальное окружение. Вы можете настроить его с помощью:
```bash
python3 -m venv venv
source venv/bin/activate
```



### 3. Установка зависимостей

Установите необходимые пакеты Python, перечисленные в файле `requirements.txt`:

```bash
pip install -r requirements.txt
```


### 4. Настройте переменные окружения

Скопируйте файл `.env.example` в корневой директории проекта в новый файл `.env`. Вам нужно будет установить следующие переменные окружения:

- `BOT_TOKEN`: Ваш Telegram Bot Token от BotFather.
- `ADMIN_IDS`: Список идентификаторов пользователей Telegram, которые будут обладать правами администратора.
- `MONGODB_NAME`: Ваше имя пользователя MongoDB.
- `MONGODB_PASSWORD`: Ваш пароль к MongoDB.
- `MONGODB_CLUSTER`: Адрес вашего кластера MongoDB.
- `API_KEY_MAP`: Ваш ключ API статических карт Яндекса. (Вы можете не заменять эту переменную на свою собственную, так как переменная в env.example является рабочей)


### 5. Запустите бота

Когда окружение настроено, вы можете запустить бота, используя:

```bash
python3 bot.py
```


Теперь бот должен быть запущен и способен отвечать на команды, отправленные в Telegram.

### 6. (Необязательно) Настройте ведение логов

В файле `.env` можно настроить параметры ведения журнала, чтобы включить или отключить ведение журнала в консоли и файлах, указать путь к файлу журнала и установить уровень ведения журнала.

## Обратная связь

Я буду благодарен за любую критику и предложения по этому проекту.

kshabalin11@yandex.ru

https://t.me/eklipsan